import{ad as R,m as y}from"./vendor-ddfd0f27.js";import{r as t,g as C,F as b,j as s,u as G}from"./react-34ba0285.js";import{b as A,am as D,an as P,ao as T,c as w,D as F,ap as M}from"./index-01b98e4e.js";import{L as S}from"./index-6813b743.js";import{N as j}from"./index-adac599a.js";import{P as I}from"./index-f2caed72.js";import"./lodash-536b9069.js";import"./react-redux-b094955d.js";import"./react-router-dom-46eb6367.js";function H(e){const[m,f]=t.exports.useState([]),r=t.exports.useMemo(()=>{const c=m.find(a=>a.id===e);return c?c.name:"\u5168\u90E8\u89C6\u9891"},[e]),i=C(b,{children:[r," ",s(R,{})]});async function v(){const c=await D();f(c.data)}return t.exports.useEffect(()=>{v()},[]),{videoGroupList:m,buttonContext:i}}function O(e){const[m,f]=t.exports.useReducer(L,[]),[r,i]=t.exports.useState(""),[v,c]=t.exports.useState(!0),a=t.exports.useRef(null);let h=0;const g=8;async function x(o=0){const u=e?await P(e,o):await T(o);c(u.hasmore);const p=u.datas.filter(d=>d.data.creator).map(d=>{const{vid:N,coverUrl:l,title:V,creator:k}=d.data,{nickname:E}=k;return{id:N,imgUrl:l,description:V,author:E}});f(o===0?{payload:p}:{type:"add",payload:p})}function L(o,{type:u="reset",payload:p}){return u==="add"?[...o,...p]:p}return t.exports.useEffect(()=>(x(),A),[e]),t.exports.useEffect(()=>{if(!a.current)return;const o=new IntersectionObserver(u=>{u[0].intersectionRatio<=0||(v?(i("\u52A0\u8F7D\u4E2D..."),h+=g,x(h)):i("\u6CA1\u6709\u66F4\u591A\u4E86~"))});return o.observe(a.current),()=>{a.current&&o.unobserve(a.current),o.disconnect()}},[]),{moreText:r,videoList:m,footerRef:a}}const Y=()=>{const e=w("video"),[m,f]=t.exports.useState([]),[r,i]=t.exports.useState(0),{push:v}=G(),{buttonContext:c,videoGroupList:a}=H(r),{moreText:h,videoList:g,footerRef:x}=O(r);function L(n){v(F.playVideo(n))}function o(n){i(n)}async function u(){const n=await M();f(n.data.map(d=>({name:d.name,id:d.id})))}function p(n){function d(l){i(l),n(!1)}function N(){i(0),n(!1)}return C("div",{className:e("popover"),children:[s("header",{className:e("popover-header"),children:s("button",{className:y({["--active"]:!r}),onClick:N,children:"\u5168\u90E8\u89C6\u9891"})}),s("div",{className:e("popover-main"),children:a.map(l=>s("div",{children:s("span",{className:y({"--active":l.id===r}),onClick:()=>d(l.id),children:l.name})},l.id))})]})}return t.exports.useEffect(()=>{u()},[]),C("div",{className:e(),children:[C("header",{className:e("header"),children:[s(I,{context:c,functionChildren:p}),s(j,{id:r,data:m,onNavClick:o})]}),s(S,{data:g,onItemClick:L}),s("footer",{ref:x,className:e("footer"),children:h})]})};export{Y as default};
