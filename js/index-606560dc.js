import{s as L}from"./collector.module-394d9900.js";import{x as q,m as R,ai as J,k as A,F as K,U as Q,a3 as V,aj as C}from"./vendor-da34c035.js";import{g as e,j as a,r as c,F as X,t as Z,u as ss}from"./react-db2799b6.js";import{a as as,u as es}from"./react-redux-a59d985d.js";import{c as f,b as S,d as _,r as E,e as ts,C as is,f as ls,h as ns,t as rs,i as cs,j as N,w as g,T as os,k as us,D as T,l as ms,m as ds,o as hs}from"./index-2448f94e.js";import{C as ps}from"./index-c374ff2e.js";import{W as bs,s as Cs}from"./write-comment-153dc286.js";import"./lodash-536b9069.js";import"./react-router-dom-66f75ae1.js";const Ns={"album-detail":"_album-detail_1r2oa_1","album-detail__title":"_album-detail__title_1r2oa_4"},gs=({description:t})=>{const l=f("album-detail",Ns);return e("div",{className:l(),children:[a("header",{className:l("title"),children:"\u4E13\u8F91\u4ECB\u7ECD"}),a("p",{children:t})]})},fs=({id:t})=>{const l=f("collector",L),[o,b]=c.exports.useState([]),[v,y]=c.exports.useState(0),[D,s]=c.exports.useState(1);async function h(i=1,u=20){const r=(i-1)*u,m=await ts({id:t,offset:r,limit:u});b(m.subscribers),y(m.total)}return c.exports.useEffect(()=>(t&&h(),S),[t]),o.length>0?e(X,{children:[a("div",{className:l(),children:o.map(i=>e("div",{className:l("item"),children:[a(_,{className:l("img"),src:E(i.avatarUrl,100)}),e("div",{children:[a("div",{className:l("title"),children:i.nickname}),i.signature&&a("div",{className:l("subtitle"),children:i.signature})]})]},i.userId))}),a("footer",{className:l("footer"),children:a(q,{current:D,total:v,onChange:(i,u)=>{s(i),h(i,u)},pageSize:100,showSizeChanger:!1})})]}):a("div",{className:l("empty"),children:"\u6682\u65E0\u6536\u85CF\u8005"})},vs=({id:t,isAlbum:l})=>{const o=f("comments-list",Cs);return e("div",{className:o(),children:[a(bs,{}),a(is,{id:t,api:l?ls:ns})]})},Ts=()=>{const t=f("list"),l=Z(),[o,b]=c.exports.useState([]),v=as(),[y,D]=c.exports.useState(""),[s,h]=c.exports.useState(),i=c.exports.useMemo(()=>Number(l.id),[l.id]),{push:u}=ss(),r=c.exports.useMemo(()=>!!l.type,[l.type]),m=es(n=>n.user.profile);function P(n=0){v(us({current:n,tracks:o,fm:[]}))}function k(n){u(T.user(n))}async function I(){const[n,B]=await Promise.all([ms(i),ds(i)]),p=n.songs.map(d=>{var x;return d.disable=(x=d==null?void 0:d.privilege)!=null&&x.cp?!d.privilege.cp:!1,d});b(p);const{picUrl:F,name:w,artist:M,publishTime:W,description:H}=n.album,{subCount:O,shareCount:$,commentCount:z}=B,G={coverImgUrl:F,name:w,subscribedCount:O,shareCount:$,commentCount:z,createTime:W,artistName:M.name};h(G),D(H)}async function U(){const n=await hs(i),B=n.playlist.tracks.map((p,F)=>(p.disable=!n.privileges[F].cp&&!p.pc,p));b(B),h(n.playlist)}function Y(){var n;return e("div",{className:t("description"),children:[e("div",{className:t("tag"),children:[a("span",{className:"--title",children:"\u6807\u7B7E: "}),a("span",{children:(n=s==null?void 0:s.tags)==null?void 0:n.join("/")})]}),e("div",{className:t("count"),children:[e("span",{children:[a("span",{className:"--title",children:"\u6B4C\u66F2\u6570: "}),g(s==null?void 0:s.trackCount)]}),e("span",{className:"--left",children:[a("span",{className:"--title",children:"\u64AD\u653E\u6570: "}),g(s==null?void 0:s.playCount)]})]}),e("div",{className:t("introduction"),children:[a("span",{className:"--title",children:"\u7B80\u4ECB: "}),a("div",{children:s==null?void 0:s.description})]})]})}function j(){return e("div",{className:t("description"),children:[e("div",{className:t("singer"),children:[a("span",{className:"--title",children:"\u6B4C\u624B: "}),a("span",{onClick:()=>u(T.singer(s==null?void 0:s.id)),children:s==null?void 0:s.artistName})]}),e("div",{className:t("publish-time"),children:[a("span",{className:"--title",children:"\u65F6\u95F4: "}),a("span",{children:A(s==null?void 0:s.createTime).format("YYYY-MM-DD")})]})]})}return c.exports.useEffect(()=>{if(!Number.isNaN(i))return r?I():U(),S},[i,r]),e("div",{className:t(),children:[e("header",{className:t("header"),children:[i&&(s==null?void 0:s.coverImgUrl)?a(_,{className:R("list__img",{"--album":r}),src:E(s.coverImgUrl,300),alt:"avatar"}):a("div",{className:t("img-default"),children:a(J,{})}),e("div",{className:t("right"),children:[e("div",{className:t("title"),children:[a("span",{children:r?"\u4E13\u8F91":"\u6B4C\u5355"}),a("strong",{children:(s==null?void 0:s.name)||"\u6211\u559C\u6B22\u7684\u97F3\u4E50"})]}),!r&&e("div",{className:t("user-info"),children:[a("img",{src:rs(E(m.avatarUrl||cs,100)),alt:"avatar",onClick:()=>k(m.userId)}),a("a",{onClick:()=>k(m.userId),children:m.nickname}),e("span",{children:[A(s==null?void 0:s.createTime).format("YYYY-MM-DD"),"\u521B\u5EFA"]})]}),e("div",{className:t("control"),children:[a(N,{compose:!0,onClick:()=>P()}),e(N,{children:[a(K,{}),"\u6536\u85CF(",g(s==null?void 0:s.subscribedCount),")"]}),e(N,{children:[a(Q,{}),"\u5206\u4EAB(",g((s==null?void 0:s.shareCount)||0),")"]}),e(N,{children:[a(V,{}),"\u4E0B\u8F7D\u5168\u90E8"]})]}),r?j():Y()]})]}),a("section",{className:t("tabs"),children:e(C,{children:[a(C.TabPane,{tab:"\u6B4C\u66F2\u5217\u8868",children:a(os,{columns:ps,data:o,onDoubleClick:P})},"1"),a(C.TabPane,{tab:`\u8BC4\u8BBA(${(s==null?void 0:s.commentCount)||0})`,children:a(vs,{id:i,isAlbum:r})},"2"),a(C.TabPane,{tab:r?"\u4E13\u8F91\u8BE6\u60C5":"\u6536\u85CF\u8005",children:r?a(gs,{description:y}):a(fs,{id:i})},"3")]})})]})};export{Ts as default};
