import{r as c,g as e,F as L,j as a,p as q,u as R}from"./react-612bda17.js";import{s as J}from"./collector.module-da30ffb6.js";import{b as S,d as _,r as F,c as f,e as K,C as Q,f as V,h as X,t as Z,i as ss,j as C,w as N,D as T,T as as,k as es,l as ts,m as is,o as ls}from"./index-d45ba440.js";import{u as ns,a as rs}from"./react-redux-aeaeff1e.js";import{U as cs,k as os,ai as us,h as x,$ as ms,a2 as ds,D as hs,aj as g}from"./vendor-7f089e7e.js";import{W as ps,s as bs}from"./write-comment-5f7f0776.js";import{C as Cs}from"./index-63f6f480.js";import"./lodash-87ac67d6.js";import"./react-router-dom-7eed272f.js";const Ns=({id:t})=>{const l=f("collector",J),[o,b]=c.exports.useState([]),[v,y]=c.exports.useState(0),[D,s]=c.exports.useState(1);async function h(i=1,u=20){const r=(i-1)*u,m=await K({id:t,offset:r,limit:u});b(m.subscribers),y(m.total)}return c.exports.useEffect(()=>(t&&h(),S),[t]),o.length>0?e(L,{children:[a("div",{className:l(),children:o.map(i=>e("div",{className:l("item"),children:[a(_,{className:l("img"),src:F(i.avatarUrl,100)}),e("div",{children:[a("div",{className:l("title"),children:i.nickname}),i.signature&&a("div",{className:l("subtitle"),children:i.signature})]})]},i.userId))}),a("footer",{className:l("footer"),children:a(cs,{current:D,total:v,onChange:(i,u)=>{s(i),h(i,u)},pageSize:100,showSizeChanger:!1})})]}):a("div",{className:l("empty"),children:"\u6682\u65E0\u6536\u85CF\u8005"})},gs=({id:t,isAlbum:l})=>{const o=f("comments-list",bs);return e("div",{className:o(),children:[a(ps,{}),a(Q,{id:t,api:l?V:X})]})};var fs={"album-detail":"_album-detail_1r2oa_1","album-detail__title":"_album-detail__title_1r2oa_4"};const vs=({description:t})=>{const l=f("album-detail",fs);return e("div",{className:l(),children:[a("header",{className:l("title"),children:"\u4E13\u8F91\u4ECB\u7ECD"}),a("p",{children:t})]})},xs=()=>{const t=f("list"),l=q(),[o,b]=c.exports.useState([]),v=ns(),[y,D]=c.exports.useState(""),[s,h]=c.exports.useState(),i=c.exports.useMemo(()=>Number(l.id),[l.id]),{push:u}=R(),r=c.exports.useMemo(()=>!!l.type,[l.type]),m=rs(n=>n.user.profile);function P(n=0){v(es({current:n,tracks:o,fm:[]}))}function k(n){u(T.user(n))}async function I(){const[n,B]=await Promise.all([ts(i),is(i)]),p=n.songs.map(d=>{var A;return d.disable=(A=d==null?void 0:d.privilege)!=null&&A.cp?!d.privilege.cp:!1,d});b(p);const{picUrl:E,name:w,artist:M,publishTime:W,description:$}=n.album,{subCount:H,shareCount:O,commentCount:z}=B,G={coverImgUrl:E,name:w,subscribedCount:H,shareCount:O,commentCount:z,createTime:W,artistName:M.name};h(G),D($)}async function U(){const n=await ls(i),B=n.playlist.tracks.map((p,E)=>(p.disable=!n.privileges[E].cp&&!p.pc,p));b(B),h(n.playlist)}function Y(){var n;return e("div",{className:t("description"),children:[e("div",{className:t("tag"),children:[a("span",{className:"--title",children:"\u6807\u7B7E: "}),a("span",{children:(n=s==null?void 0:s.tags)==null?void 0:n.join("/")})]}),e("div",{className:t("count"),children:[e("span",{children:[a("span",{className:"--title",children:"\u6B4C\u66F2\u6570: "}),N(s==null?void 0:s.trackCount)]}),e("span",{className:"--left",children:[a("span",{className:"--title",children:"\u64AD\u653E\u6570: "}),N(s==null?void 0:s.playCount)]})]}),e("div",{className:t("introduction"),children:[a("span",{className:"--title",children:"\u7B80\u4ECB: "}),a("div",{children:s==null?void 0:s.description})]})]})}function j(){return e("div",{className:t("description"),children:[e("div",{className:t("singer"),children:[a("span",{className:"--title",children:"\u6B4C\u624B: "}),a("span",{onClick:()=>u(T.singer(s==null?void 0:s.id)),children:s==null?void 0:s.artistName})]}),e("div",{className:t("publish-time"),children:[a("span",{className:"--title",children:"\u65F6\u95F4: "}),a("span",{children:x(s==null?void 0:s.createTime).format("YYYY-MM-DD")})]})]})}return c.exports.useEffect(()=>{if(!Number.isNaN(i))return r?I():U(),S},[i,r]),e("div",{className:t(),children:[e("header",{className:t("header"),children:[i&&(s==null?void 0:s.coverImgUrl)?a(_,{className:os("list__img",{"--album":r}),src:F(s.coverImgUrl,300),alt:"avatar"}):a("div",{className:t("img-default"),children:a(us,{})}),e("div",{className:t("right"),children:[e("div",{className:t("title"),children:[a("span",{children:r?"\u4E13\u8F91":"\u6B4C\u5355"}),a("strong",{children:(s==null?void 0:s.name)||"\u6211\u559C\u6B22\u7684\u97F3\u4E50"})]}),!r&&e("div",{className:t("user-info"),children:[a("img",{src:Z(F(m.avatarUrl||ss,100)),alt:"avatar",onClick:()=>k(m.userId)}),a("a",{onClick:()=>k(m.userId),children:m.nickname}),e("span",{children:[x(s==null?void 0:s.createTime).format("YYYY-MM-DD"),"\u521B\u5EFA"]})]}),e("div",{className:t("control"),children:[a(C,{compose:!0,onClick:()=>P()}),e(C,{children:[a(ms,{}),"\u6536\u85CF(",N(s==null?void 0:s.subscribedCount),")"]}),e(C,{children:[a(ds,{}),"\u5206\u4EAB(",N((s==null?void 0:s.shareCount)||0),")"]}),e(C,{children:[a(hs,{}),"\u4E0B\u8F7D\u5168\u90E8"]})]}),r?j():Y()]})]}),a("section",{className:t("tabs"),children:e(g,{children:[a(g.TabPane,{tab:"\u6B4C\u66F2\u5217\u8868",children:a(as,{columns:Cs,data:o,onDoubleClick:P})},"1"),a(g.TabPane,{tab:`\u8BC4\u8BBA(${(s==null?void 0:s.commentCount)||0})`,children:a(gs,{id:i,isAlbum:r})},"2"),a(g.TabPane,{tab:r?"\u4E13\u8F91\u8BE6\u60C5":"\u6536\u85CF\u8005",children:r?a(vs,{description:y}):a(Ns,{id:i})},"3")]})})]})};export{xs as default};
