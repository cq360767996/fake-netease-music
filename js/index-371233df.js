import{r as l,h as t,j as i,q as G,u as I}from"./react-1b56b61c.js";import{t as F,I as Y,c as M,b as $,d as U,r as q,w as u,j as x,C as H,$ as L,a0 as W,D as k,a1 as K,a2 as J,a3 as Q,a4 as X,a5 as Z,a6 as ee}from"./index-c941e042.js";import{ac as ae,z as te,K as ie,$ as oe,a2 as se,h as re}from"./vendor-e7a31927.js";import{W as le}from"./write-comment-b563f850.js";import"./lodash-87ac67d6.js";import"./react-router-dom-1f34616f.js";import"./react-redux-6f2a0ace.js";const ne="_video_1pcl7_1",de="_video__control_1pcl7_14",ce="_video__pause_1pcl7_29";var ue={video:ne,video__control:de,video__pause:ce};const pe=({src:a})=>{const p=M("video",ue),[s,e]=l.exports.useState(!1),n=l.exports.useRef(null);return t("div",{className:p(),children:[i("video",{ref:n,src:F(a),autoPlay:!0,controls:!0,onPause:()=>e(!0),onPlay:()=>e(!1)}),s&&i(Y,{type:"play",size:"giant",className:p("pause"),onClick:()=>{var c;return(c=n.current)==null?void 0:c.play()}})]})},ye=()=>{const a=M("play-video"),s=G().id,[e,n]=l.exports.useState(),[c,V]=l.exports.useState(""),[P,z]=l.exports.useState([]),{goBack:E}=I(),D=l.exports.useMemo(()=>!Number.isNaN(Number(s)),[s]),{push:m}=I();async function j(){const o=await K(s),{creator:r,title:d,publishTime:v,playTime:h,videoGroup:g,praisedCount:_,subscribeCount:f,shareCount:w,commentCount:y}=o.data,b=re(v).format("YYYY-MM-DD"),{avatarUrl:C,nickname:N,userId:B}=r;n({title:d,publishTime:b,playTime:h,videoGroup:g,praisedCount:_,subscribeCount:f,shareCount:w,commentCount:y,avatarUrl:C,nickname:N,userId:B})}async function T(){const[o,r]=await Promise.all([J(Number(s)),Q(Number(s))]),{name:d,publishTime:v,playCount:h,videoGroup:g,subCount:_,shareCount:f,commentCount:w,artistName:y,cover:b,artistId:C}=o.data,{likedCount:N}=r;n({title:d,publishTime:v,playTime:h,videoGroup:g,subscribeCount:_,shareCount:f,commentCount:w,praisedCount:N,nickname:y,avatarUrl:b,artistId:C})}async function O(){var r;const o=await X(s);V((r=o.urls)==null?void 0:r[0].url)}async function R(){const o=await Z(Number(s));V(o.data.url)}async function S(){const o=await ee(s);z(o.data)}function A(){e!=null&&e.artistId?m(k.singer(e.artistId)):e!=null&&e.userId&&m(k.user(e.userId))}return l.exports.useEffect(()=>(D?(T(),R()):(j(),O()),S(),$),[s]),i("div",{className:a(),children:t("div",{className:a("detail"),children:[t("div",{className:a("left"),children:[i("h2",{className:a("title"),children:t("span",{onClick:()=>E(),children:[i(ae,{})," \u89C6\u9891\u8BE6\u60C5"]})}),i(pe,{src:c}),t("div",{className:a("author-wrapper"),children:[e&&t("div",{className:a("author"),children:[i(U,{className:a("avatar"),src:q(e.avatarUrl,50),onClick:A}),i("strong",{onClick:A,children:e.nickname})]}),t("button",{className:a("follow"),children:[i(te,{})," \u5173\u6CE8"]})]}),i("h2",{className:a("name"),children:e==null?void 0:e.title}),t("div",{className:a("publish"),children:[t("span",{children:["\u53D1\u5E03: ",e==null?void 0:e.publishTime]}),t("span",{children:["\u64AD\u653E: ",u(e==null?void 0:e.playTime),"\u6B21"]})]}),i("div",{className:a("tags"),children:e==null?void 0:e.videoGroup.map(o=>i("div",{className:a("tag"),children:o.name},o.id))}),t("div",{className:a("button-group"),children:[t("div",{children:[t(x,{children:[i(ie,{}),"\u8D5E",u(e==null?void 0:e.praisedCount)]}),t(x,{children:[i(oe,{}),"\u6536\u85CF",u(e==null?void 0:e.subscribeCount)]}),t(x,{children:[i(se,{}),"\u5206\u4EAB",u(e==null?void 0:e.shareCount)]})]}),i("a",{children:"\u4E3E\u62A5"})]}),t("h3",{className:a("comment"),children:["\u542C\u53CB\u8BC4\u8BBA ",t("span",{children:["(\u5DF2\u6709",e==null?void 0:e.commentCount,"\u8BC4\u8BBA)"]})]}),i(le,{}),i(H,{id:s,api:D?L:W})]}),t("div",{className:a("right"),children:[i("h2",{className:a("title"),children:"\u76F8\u5173\u63A8\u8350"}),P.map(o=>t("div",{className:a("item"),children:[i(U,{className:a("item-img"),src:o.coverUrl,onClick:()=>m(k.playVideo(o.vid))}),t("div",{className:a("item-description"),children:[i("div",{className:a("item-title"),children:o.title}),t("div",{className:a("item-author"),children:["by ",o.creator.reduce((r,d)=>`${r}/${d.userName}`,"").slice(1)]})]})]},o.vid))]})]})})};export{ye as default};
