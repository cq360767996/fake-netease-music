import{r as o,h as x,F as N,j as r,u as V}from"./react-1b56b61c.js";import{b as E,am as R,an as G,ao as A,c as D,D as P,ap as T}from"./index-c941e042.js";import{N as j}from"./index-82fcd55f.js";import{L as F}from"./index-3af61bbc.js";import{P as M}from"./index-e8f2774d.js";import{ad as S,k as b}from"./vendor-e7a31927.js";import"./lodash-87ac67d6.js";import"./react-router-dom-1f34616f.js";import"./react-redux-6f2a0ace.js";function I(e){const[v,m]=o.exports.useState([]),a=o.exports.useMemo(()=>{const d=v.find(i=>i.id===e);return d?d.name:"\u5168\u90E8\u89C6\u9891"},[e]),s=x(N,{children:[a," ",r(S,{})]});async function f(){const d=await R();m(d.data)}return o.exports.useEffect(()=>{f()},[]),{videoGroupList:v,buttonContext:s}}function H(e){const[v,m]=o.exports.useReducer(_,[]),[a,s]=o.exports.useState(""),[f,d]=o.exports.useState(!0),i=o.exports.useRef(null);let h=0;const w=8;async function g(t=0){const c=e?await G(e,t):await A(t);d(c.hasmore);const l=c.datas.filter(p=>p.data.creator).map(p=>{const{vid:y,coverUrl:u,title:C,creator:k}=p.data,{nickname:L}=k;return{id:y,imgUrl:u,description:C,author:L}});m(t===0?{payload:l}:{type:"add",payload:l})}function _(t,{type:c="reset",payload:l}){return c==="add"?[...t,...l]:l}return o.exports.useEffect(()=>(g(),E),[e]),o.exports.useEffect(()=>{if(!i.current)return;const t=new IntersectionObserver(c=>{c[0].intersectionRatio<=0||(f?(s("\u52A0\u8F7D\u4E2D..."),h+=w,g(h)):s("\u6CA1\u6709\u66F4\u591A\u4E86~"))});return t.observe(i.current),()=>{i.current&&t.unobserve(i.current),t.disconnect()}},[]),{moreText:a,videoList:v,footerRef:i}}const X=()=>{const e=D("video"),[v,m]=o.exports.useState([]),[a,s]=o.exports.useState(0),{push:f}=V(),{buttonContext:d,videoGroupList:i}=I(a),{moreText:h,videoList:w,footerRef:g}=H(a);function _(n){f(P.playVideo(n))}function t(n){s(n)}async function c(){const n=await T();m(n.data.map(p=>({name:p.name,id:p.id})))}function l(n){function p(u){s(u),n(!1)}function y(){s(0),n(!1)}return x("div",{className:e("popover"),children:[r("header",{className:e("popover-header"),children:r("button",{className:b({["--active"]:!a}),onClick:y,children:"\u5168\u90E8\u89C6\u9891"})}),r("div",{className:e("popover-main"),children:i.map(u=>r("div",{children:r("span",{className:b({"--active":u.id===a}),onClick:()=>p(u.id),children:u.name})},u.id))})]})}return o.exports.useEffect(()=>{c()},[]),x("div",{className:e(),children:[x("header",{className:e("header"),children:[r(M,{context:d,functionChildren:l}),r(j,{id:a,data:v,onNavClick:t})]}),r(F,{data:w,onItemClick:_}),r("footer",{ref:g,className:e("footer"),children:h})]})};export{X as default};
